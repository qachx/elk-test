# 🏦 Banking ELK Test Environment

Полностью автоматизированная симуляция банковской системы для изучения ELK Stack, Prometheus и Grafana.

## 🚀 Быстрый старт

### Автоматический запуск (рекомендуется):
```bash
# Linux/Mac
chmod +x start.sh
./start.sh

# Windows
start.bat
```

### Ручной запуск:
```bash
# Клонируем проект
git clone <your-repo>
cd elk-test

# Запускаем всё одной командой
docker-compose up -d

# Ждём 2-3 минуты и переходим по адресам:
```

## 📊 Доступные интерфейсы

| Сервис | URL | Описание |
|--------|-----|----------|
| **Kibana** | http://localhost:5601 | Анализ логов, дашборды ✅ ГОТОВЫЕ ДАШБОРДЫ |
| **Grafana** | http://localhost:3000 | Метрики, мониторинг (admin/admin) ✅ ГОТОВЫЕ ДАШБОРДЫ |
| **Elasticsearch** | http://localhost:9200 | REST API для поиска |
| **Prometheus** | http://localhost:9090 | Сбор метрик |
| **Metrics Exporter** | http://localhost:8081/metrics | Банковские метрики |

### 🎉 Всё настроено автоматически!

- ✅ **Data Views** создаются сами
- ✅ **Дашборды** готовы из коробки  
- ✅ **Индексы** правильно настроены
- ✅ **Никаких ручных настроек** не требуется!

## 🎯 Практические задания

### Задание 1: Знакомство с Kibana Discover 🔍
**Цель:** Освоить базовый поиск и фильтрацию в Kibana

**Шаги:**
1. Откройте Kibana → Discover
2. ✅ Data View `banking-logs-*` уже создан автоматически!
3. Найдите все логи с `level: "WARN"` за последний час
4. Добавьте фильтр по сервису: `service: "auth-service"`
5. Найдите события типа `login_failed`
6. Определите топ-3 пользователей по количеству событий

**Ожидаемый результат:** Понимание базового поиска, создания фильтров

### Задание 2: Анализ ошибок платежей 💸
**Цель:** Научиться анализировать ошибки в системе платежей

**Шаги:**
1. Найдите все логи `payment-service` со статусом `failed`
2. Создайте фильтр для ошибки `insufficient_funds`
3. Постройте гистограмму ошибок по времени (по часам)
4. Определите самую частую ошибку платежей
5. Найдите суммы неудачных транзакций

**Ожидаемый результат:** Визуализация трендов ошибок, понимание паттернов

### Задание 3: Мониторинг подозрительной активности 🚨
**Цель:** Обнаружение подозрительных транзакций

**Шаги:**
1. Найдите транзакции больше 500,000 рублей
2. Найдите все ночные транзакции (00:00-06:00)
3. Создайте фильтр для тега `suspicious_amount`
4. Найдите транзакции с высоким risk_score (>80)
5. Изучите географию подозрительных IP адресов

**Ожидаемый результат:** Навыки поиска аномалий, работа с тегами

### Задание 4: Работа с готовым дашбордом в Kibana 📊
**Цель:** Изучение готового дашборда и создание собственного

**Шаги:**
1. ✅ Откройте готовый дашборд "Banking Security Overview"
2. Изучите как настроены виджеты
3. Создайте свой дашборд "My Banking Dashboard"
4. Добавьте виджет: общее количество транзакций (Metric)
5. Добавьте график: ошибки по времени (Line chart)
6. Добавьте таблицу: топ ошибок по сервисам (Data table)
7. Настройте автообновление каждые 30 секунд

**Ожидаемый результат:** Понимание готовых решений + собственный дашборд

### Задание 5: Elasticsearch Query DSL 🔧
**Цель:** Освоить запросы через REST API

**Шаги:**
1. Откройте Kibana → Dev Tools
2. Выполните простой поиск всех логов:
   ```json
   GET banking-logs-*/_search
   {
     "query": {"match_all": {}}
   }
   ```
3. Найдите заблокированные аккаунты:
   ```json
   GET banking-logs-*/_search
   {
     "query": {
       "term": {"event_type": "account_locked"}
     }
   }
   ```
4. Создайте агрегацию по сервисам
5. Найдите транзакции больше 100,000 рублей

**Ожидаемый результат:** Понимание Query DSL, работа с API

### Задание 6: Logstash Pipeline анализ ⚙️
**Цель:** Понимание обработки логов в Logstash

**Шаги:**
1. Изучите файл `logstash/pipeline/banking.conf`
2. Найдите как парсятся JSON логи vs текстовые
3. Изучите фильтры для geoip обработки
4. Найдите правила добавления тегов `suspicious_amount`
5. Поймите маппинг по индексам

**Ожидаемый результат:** Понимание pipeline обработки данных

### Задание 7: Prometheus метрики 📈
**Цель:** Работа с метриками и PromQL

**Шаги:**
1. Откройте Prometheus → Graph
2. Изучите метрику `banking_active_users`
3. Постройте график роста транзакций:
   ```
   increase(banking_transaction_amount_total[1h])
   ```
4. Найдите средний error rate:
   ```
   avg(banking_error_rate)
   ```
5. Изучите размеры очередей: `banking_queue_size`

**Ожидаемый результат:** Базовые навыки PromQL, понимание метрик

### Задание 8: Grafana дашборды 📊
**Цель:** Создание продвинутых дашбордов

**Шаги:**
1. Откройте готовый дашборд "Banking System Overview"
2. Создайте новый дашборд "Performance Monitoring"
3. Добавьте панель: время ответа сервисов
4. Создайте алерт при error rate > 5%
5. Настройте уведомления

**Ожидаемый результат:** Продвинутые дашборды с алертами

### Задание 9: Корреляция данных 🔗
**Цель:** Связывание логов и метрик

**Шаги:**
1. В Kibana найдите пик ошибок по времени
2. В Grafana проверьте метрики в то же время
3. Сопоставьте высокую нагрузку с ошибками
4. Найдите связь между queue_size и processing_time
5. Создайте гипотезу о причинах проблем

**Ожидаемый результат:** Навыки корреляционного анализа

### Задание 10: Экспорт и отчёты 📋
**Цель:** Создание отчётов для команды

**Шаги:**
1. Экспортируйте дашборд из Kibana (JSON)
2. Создайте снимок экрана графиков
3. В Grafana создайте PDF отчёт
4. Сохраните важные поисковые запросы
5. Создайте итоговый отчёт о состоянии системы

**Ожидаемый результат:** Готовые отчёты для презентации

## 🏗️ Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Auth Service   │    │ Payment Service │    │  Fraud Service  │
│   (Logs)        │    │     (Logs)      │    │     (Logs)      │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │        Logstash           │
                    │    (Log Processing)       │
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │     Elasticsearch         │
                    │    (Log Storage)          │
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │        Kibana             │
                    │   (Visualization)         │
                    └───────────────────────────┘

    ┌─────────────────┐    ┌─────────────────┐
    │   Prometheus    │    │     Grafana     │
    │   (Metrics)     │    │   (Dashboards)  │
    └─────────────────┘    └─────────────────┘
```

## 📁 Структура проекта

```
elk-test/
├── docker-compose.yml          # Основная конфигурация
├── generators/                 # Генераторы логов
│   ├── auth-service/
│   ├── payment-service/
│   └── fraud-service/
├── logstash/                  # Конфигурации Logstash
├── kibana/                    # Дашборды Kibana
├── grafana/                   # Дашборды Grafana
└── prometheus/                # Конфигурация Prometheus
```

## 🔧 Что симулируется

### Сервисы:
- **🔐 Auth Service**: Входы, регистрации, блокировки аккаунтов
- **💰 Payment Service**: Переводы, платежи, ошибки транзакций
- **🚨 Fraud Service**: Обнаружение подозрительных операций
- **📱 Notification Service**: Отправка уведомлений

### Реалистичные данные:
- Имена и фамилии пользователей
- IBAN номера счетов
- Суммы от 100 до 100,000 рублей
- Временные паттерны (больше активности днём)

### Ошибки и проблемы:
- 5% ошибок в транзакциях
- Блокировки подозрительных аккаунтов
- Тайм-ауты сервисов
- Превышение лимитов

## 📈 Метрики

- HTTP запросы и ответы
- Время отклика сервисов
- Количество ошибок
- Активные пользователи
- Объём транзакций

## 🛠️ Остановка системы

```bash
docker-compose down
```

## ❓ Проблемы?

Если что-то не работает, смотрите [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - там собраны решения всех частых проблем.

## 🎓 Для инструкторов

Этот проект создан для практического обучения тестировщиков работе с ELK Stack. Он включает:

- ✅ **Полную автоматизацию** - запуск одной командой
- ✅ **Реалистичные данные** - банковские транзакции, имена, IBAN
- ✅ **Разнообразие логов** - JSON, текстовые, различные уровни
- ✅ **Метрики** - интеграция с Prometheus/Grafana  
- ✅ **10 практических заданий** - от базового поиска до корреляции
- ✅ **Проблемы как в боевой системе** - ошибки, подозрительные транзакции
- ✅ **Подробную документацию** - каждый шаг расписан

---
*Создано для практического изучения ELK Stack в тестировании* 